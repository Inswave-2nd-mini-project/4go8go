<!-- fragments/header.html -->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<div th:fragment="header">

<!--&lt;!&ndash; CSS 임포트 (순서대로) &ndash;&gt;-->
<!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">-->
<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">-->
<!--<link rel="stylesheet" type="text/css" th:href="@{/css/index.css}" />-->
<!--<link rel="stylesheet" type="text/css" th:href="@{/css/header.css}" />-->
<!--<link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}" />-->
<!--<link rel="stylesheet" type="text/css" th:href="@{/css/notification.css}" />-->

<!--&lt;!&ndash; CSRF 토큰 (필수) &ndash;&gt;-->
<!--<meta name="_csrf" th:content="${_csrf.token}">-->
<!--<meta name="_csrf_header" th:content="${_csrf.headerName}">-->

<!-- 상단 배너 -->
<div class="top-banner">
    지금 가입하면 3,000원 적립금과 생일 축하 쿠폰을 드려요!
</div>

<!-- 헤더 (로그인/회원가입) -->
<header class="container">
    <div class="header-top">
        <div></div>
        <ul class="user-menu">

            <!-- 비로그인 상태 -->
            <li sec:authorize="!isAuthenticated()">
                <a href="/join">회원가입</a>
            </li>
            <li sec:authorize="!isAuthenticated()">
                <a href="/login">로그인</a>
            </li>

            <!-- 로그인 상태 -->
            <li sec:authorize="isAuthenticated()">
                <span sec:authentication="name"></span>님
            </li>
            <li sec:authorize="isAuthenticated()">
                <form action="/logout" method="post" style="display: inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" style="background: none; border: none; cursor: pointer; padding: 0; color: #666; font-size: 12px;">
                        로그아웃
                    </button>
                </form>
            </li>

            <!-- 공통 메뉴 -->
            <li><a href="#">고객센터</a></li>

        </ul>

    </div>

    <!-- 로고, 검색창, 아이콘 -->
    <div class="logo-area">
        <a href="/" class="logo"><img src="/image/4go8go_logo.png" alt="4고8고마켓" height="40"></a>
        <div class="icons">
            <a href="/user/profile"><i class="bi bi-person"></i></a>
            <a href="#"><i class="bi bi-cart"></i></a>
            <a href="/chat/room" id="chatMessageIcon"><i class="bi bi-messenger"></i></a>
            <th:block sec:authorize="isAuthenticated()" th:replace="~{fragments/notification :: notification}"></th:block>
        </div>
    </div>

    <!-- 메인 네비게이션 -->
    <nav class="main-nav">
        <ul>
            <li><a href="#"><i class="bi bi-list"></i> 전체 카테고리</a></li>
            <li><a th:href="@{/product}">중고 거래</a></li>
            <li><a href="#">인기 상품</a></li>
            <li><a th:href="@{/post}">자유게시판</a></li>


            <!-- 관리자 메뉴 -->
            <th:block sec:authorize="hasRole('ROLE_ADMIN')">
                <li><a href="/admin" style="color: var(--sub-color);">관리자</a></li>

            </th:block>

        </ul>
    </nav>
    <!-- 알림 모달 -->
    <div id="notificationModal" class="notification-modal" style="display: none;">
        <div class="notification-modal-content">
            <div class="notification-modal-header">
                <h5>최근 알림</h5>
                <span class="notification-modal-close" onclick="closeNotificationModal()">&times;</span>
            </div>
            <div class="notification-modal-body" id="notificationList">
                <!-- 여기에 알림 목록 동적으로 로드 -->
                <div class="notification-loading">
                    <i class="bi bi-arrow-repeat spin"></i> 알림을 불러오는 중...
                </div>
            </div>
            <div class="notification-modal-footer">
                <button onclick="markAllAsRead()" class="notification-modal-button" id="markAllReadButton">전체 읽음</button>
                <a href="/notifications" class="notification-modal-link">모든 알림 보기</a>
            </div>
        </div>
    </div>

    <script src="/js/notification-chat.js"></script>

</header>

<!--&lt;!&ndash; JavaScript 임포트 (순서대로) &ndash;&gt;-->
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>-->
<!--&lt;!&ndash; 알림 관련 스크립트 (로드 순서 중요) &ndash;&gt;-->
<!--<script th:src="@{/js/notification-utils.js}" sec:authorize="isAuthenticated()"></script>-->
<!--<script th:src="@{/js/notification-chat.js}" sec:authorize="isAuthenticated()"></script>-->
<!--<script th:src="@{/js/notification-ui.js}" sec:authorize="isAuthenticated()"></script>-->
<!--<script th:src="@{/js/notification-sse.js}" sec:authorize="isAuthenticated()"></script>-->

</div>
</html>